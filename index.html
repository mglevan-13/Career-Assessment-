<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chewy’s Career Calculator</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b1220;color:#e9efff}
    header{padding:16px;border-bottom:1px solid rgba(255,255,255,.12);position:sticky;top:0;background:rgba(11,18,32,.88);backdrop-filter:blur(10px)}
    .wrap{max-width:1040px;margin:0 auto;padding:0 14px}
    .muted{color:rgba(233,239,255,.70);font-size:13px;line-height:1.45}
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:16px;margin:14px 0}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{cursor:pointer;border-radius:14px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.08);color:#e9efff;padding:12px 14px;font-weight:900;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}
    .btn:hover{background:rgba(255,255,255,.12)}
    .btn.primary{background:linear-gradient(135deg,#2f6bff,#1f4ed0);border-color:rgba(47,107,255,.8)}
    .opt{width:100%;text-align:left}
    .barWrap{height:10px;border-radius:999px;background:rgba(255,255,255,.10);overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#2f6bff,#7fb1ff);transition:width .2s}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:7px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);font-size:12.5px;color:rgba(233,239,255,.72)}
    .pill b{color:#e9efff}
    input,select{width:100%;padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);color:#e9efff;outline:none}
    code{background:rgba(0,0,0,.25);padding:2px 6px;border-radius:8px;border:1px solid rgba(255,255,255,.10)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .col6{grid-column:span 6}
    .col12{grid-column:span 12}
    @media (max-width:820px){.col6{grid-column:span 12}}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <div>
        <div style="font-weight:950;font-size:18px">Chewy’s Career Calculator</div>
        <div class="muted"><b>“Ask and it will be given to you; seek and you will find.”</b> — Matthew 7:7 (NIV)</div>
        <div class="muted" id="status">Loading…</div>
      </div>
      <div class="row">
        <button class="btn" id="resetBtn">Reset</button>
        <button class="btn" id="saveBtn">Save</button>
        <button class="btn" id="loadBtn">Load</button>
        <button class="btn" id="printBtn">Print</button>
      </div>
    </div>
    <div class="barWrap" style="margin-top:10px"><div class="bar" id="bar"></div></div>
  </div>
</header>

<main class="wrap">
  <div class="card" id="app"></div>
</main>

<script>
// Auto-detect GitHub Pages base path (works for user pages and project pages)
const basePath = (function(){
  const p = window.location.pathname;
  // If path ends with '/', use it. Otherwise drop the last segment (index.html)
  const dir = p.endsWith('/') ? p : p.substring(0, p.lastIndexOf('/')+1);
  return dir;
})();

const MAX_Q = 80;          // <— asks 80 questions
const SHOW_TOP = 30;

const DIMS = ["R","I","A","S","E","C","people","systems","creative","handsOn","structure","autonomy","outdoors","travel","focusDesk","stressTol","service","persuasion","detail","leadership","eduTolerance","debtAversion"];

let QUESTIONS=null, CAREERS=null;

let state = {
  answered: 0,
  askedIds: [],
  scores: {},
  finished: false,
  seed: Math.floor(Math.random()*1e9)
};

function initScores(){ state.scores = {}; for (const d of DIMS) state.scores[d]=0; }
initScores();

let sectionScores = {};
function initSectionScores(){ sectionScores = {}; }
initSectionScores();


const elApp = document.getElementById("app");
const elStatus = document.getElementById("status");
const elBar = document.getElementById("bar");

document.getElementById("resetBtn").onclick = () => resetAll();
document.getElementById("printBtn").onclick = () => window.print();
document.getElementById("saveBtn").onclick = () => saveLocal();
document.getElementById("loadBtn").onclick = () => loadLocal();

function setStatus(msg){ elStatus.textContent = msg; }
function setBar(){ elBar.style.width = (state.answered / MAX_Q * 100) + "%"; }
function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }
function escapeHtml(str){ return String(str).replace(/[&<>"']/g, s=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[s])); }

function rng(){
  const x = Math.sin(state.seed++) * 10000;
  return x - Math.floor(x);
}

function saveLocal(){
  const payload = {v:1, state, ts: Date.now()};
  localStorage.setItem("career_assess_save", JSON.stringify(payload));
  setStatus("Saved on this device.");
}
function loadLocal(){
  const raw = localStorage.getItem("career_assess_save");
  if (!raw){ setStatus("No saved session found on this device."); return; }
  try{
    const payload = JSON.parse(raw);
    if (payload?.state){ state = payload.state; setStatus("Loaded saved session."); render(); }
    else setStatus("Save data invalid.");
  }catch(e){ setStatus("Could not read saved session."); }
}

async function fetchJson(path){
  const url = path + (path.includes("?") ? "&" : "?") + "cb=" + Date.now();
  const res = await fetch(url, {cache:"no-store"});
  const txt = await res.text();
  return {ok: res.ok, status: res.status, statusText: res.statusText, text: txt, url};
}
function jsonParseStrict(txt){
  if (txt.includes("/*") || txt.includes("//")){
    throw new Error("Invalid JSON: comments detected. Remove // and /* */ from JSON files.");
  }
  return JSON.parse(txt);
}
function setupError(details){
  elApp.innerHTML = `
    <div style="font-weight:950;font-size:18px;margin-bottom:6px">Setup error</div>
    <div class="muted">Your site couldn't load <b>questions.json</b> and/or <b>careers.json</b> from the same folder as <b>index.html</b>.</div>
    <div style="height:1px;background:rgba(255,255,255,.12);margin:14px 0"></div>
    <div class="grid">
      <div class="card col6">
        <div style="font-weight:900">Quick checklist</div>
        <div class="muted" style="margin-top:8px">
          1) Filenames must match exactly (case-sensitive):<br>
          <span class="pill"><b>index.html</b></span>
          <span class="pill"><b>questions.json</b></span>
          <span class="pill"><b>careers.json</b></span><br><br>
          2) All three files must be in the repo <b>root</b> (same level).<br>
          3) JSON must be strict: <b>no comments</b> like <code>//</code> or <code>/* */</code>.<br>
          4) GitHub Pages can take a minute to update; refresh twice.
        </div>
      </div>
      <div class="card col6">
        <div style="font-weight:900">Diagnostics</div>
        <div class="muted" style="margin-top:8px;white-space:pre-wrap">${escapeHtml(details)}</div>
      </div>
    </div>
  `;
}

async function loadData(){
  try{
    const q = await fetchJson(basePath + "questions.json");
    if (!q.ok) throw new Error(`questions.json HTTP ${q.status} at ${q.url}`);
    const c = await fetchJson(basePath + "careers.json");
    if (!c.ok) throw new Error(`careers.json HTTP ${c.status} at ${c.url}`);

    const qObj = jsonParseStrict(q.text);
    const cObj = jsonParseStrict(c.text);

    QUESTIONS = (qObj.questions || []).filter(x => x && x.id && x.text && x.weights);
    CAREERS = (cObj.careers || []).filter(x => x && x.id && x.title && x.family && x.profile);

    if (!QUESTIONS.length) throw new Error("questions.json loaded but contained 0 usable questions.");
    if (!CAREERS.length) throw new Error("careers.json loaded but contained 0 usable careers.");

    setStatus(`Loaded ${QUESTIONS.length} questions and ${CAREERS.length} careers.`);
    render();
  }catch(e){
    setStatus("Setup error — see details below.");
    setupError(String(e && e.message ? e.message : e));
  }
}

function pickNextQuestion(){
  const asked = new Set(state.askedIds);
  const pool = QUESTIONS.filter(q => !asked.has(q.id));
  if (!pool.length) return null;

  // uncertainty-based adaptive selection + avoid repeating same section too much
  const uncertainty = {};
  for (const d of DIMS) uncertainty[d] = 1 / (1 + Math.abs(state.scores[d]));

  const recent = state.askedIds.slice(-10).map(id => QUESTIONS.find(x=>x.id===id)).filter(Boolean);
  const recentSections = recent.map(x=>x.section);
  const sectionCounts = {};
  for (const s of recentSections) sectionCounts[s] = (sectionCounts[s]||0)+1;

  let best=null, bestScore=-Infinity;
  for (const q of pool){
    let s=0;
    for (const [dim,w] of Object.entries(q.weights)){
      s += (uncertainty[dim] || 0.25) * Math.abs(w);
    }
    // balance sections
    const sc = sectionCounts[q.section] || 0;
    s -= sc * 0.18;

    // avoid near-duplicate feel by penalizing very similar starts
    const start = q.text.toLowerCase().split(" ").slice(0,6).join(" ");
    const tooSimilar = recent.some(r => (r.text.toLowerCase().split(" ").slice(0,6).join(" ") === start));
    if (tooSimilar) s -= 0.6;

    s += rng()*0.05;
    if (s>bestScore){ bestScore=s; best=q; }
  }
  return best;
}


function applyAnswer(q, value){
  const centered = value - 3; // -2..+2
  for (const [dim,w] of Object.entries(q.weights)){
    state.scores[dim] = (state.scores[dim]||0) + centered*w;
  }
  const sec = q.section || q.category || "Other";
  if (!sectionScores[sec]) sectionScores[sec] = {};
  for (const [dim,w] of Object.entries(q.weights)){
    sectionScores[sec][dim] = (sectionScores[sec][dim]||0) + centered*w;
  }
  state.askedIds.push(q.id);
  state.answered++;
}


function likertLabel(v){
  if (v===1) return "Strongly disagree / Not me";
  if (v===2) return "Somewhat disagree";
  if (v===3) return "Neutral / Depends";
  if (v===4) return "Somewhat agree";
  return "Strongly agree / Very me";
}

window.answer = function(qid, value){
  const q = QUESTIONS.find(x=>x.id===qid);
  if (!q) return;
  applyAnswer(q, value);
  renderQuestion();
}

function renderQuestion(){
  setBar();
  if (state.answered >= MAX_Q) return renderResults();
  const q = pickNextQuestion();
  if (!q) return renderResults();

  setStatus(`Question ${state.answered+1} of ${MAX_Q} • ${q.section}`);
  elApp.innerHTML = `
    <div class="pill"><b>${escapeHtml(q.section)}</b></div>
    <div style="font-weight:950;font-size:18px;margin:8px 0 6px">${escapeHtml(q.text)}</div>
    <div class="muted">${escapeHtml(q.hint || "Answer honestly.")}</div>
    <div style="height:1px;background:rgba(255,255,255,.12);margin:14px 0"></div>
    <div class="row">
      ${[1,2,3,4,5].map(v=>`
        <button class="btn opt" onclick="window.answer('${q.id}', ${v})">${likertLabel(v)}</button>
      `).join("")}
    </div>
    <div style="height:1px;background:rgba(255,255,255,.12);margin:14px 0"></div>
    <div class="muted"><b>Zig:</b> “You don’t find your future by guessing. You find it by testing what fits.”</div>
  `;
}

function dot(profile, scores){
  let s=0;
  for (const [k,v] of Object.entries(profile)){
    s += (scores[k]||0) * v;
  }
  return s;
}

function dotWithScores(profile, scores){
  let s=0;
  for (const [k,v] of Object.entries(profile||{})){
    s += (scores[k]||0) * v;
  }
  return s;
}
function sectionFit(c, secName){
  const secScores = sectionScores[secName] || {};
  return dotWithScores(c.profile, secScores);
}
function normalizePct(val, min, max){
  if (max <= min) return 50;
  const x = (val - min) / (max - min);
  return Math.round(Math.max(0, Math.min(100, x*100)));
}
function whyBySection(c, secName){
  const secScores = sectionScores[secName] || {};
  const tops = Object.entries(secScores)
    .map(([k,v])=>({k,v}))
    .sort((a,b)=>Math.abs(b.v)-Math.abs(a.v))
    .filter(x=>Math.abs(x.v)>=1.2)
    .slice(0,4);

  const profKeys = new Set(Object.keys(c.profile||{}));
  const picks = tops.filter(t=>profKeys.has(t.k)).slice(0,2);
  if (!picks.length) return "Matches your pattern in this category.";
  const phrases = picks.map(p=>{
    const dir = p.v>=0 ? "you tend to like" : "you tend to avoid";
    return `${dir} ${signalLabel(p.k)}`;
  });
  return phrases.join("; ") + ".";
}

function careerFit(c){
  let s = dot(c.profile, state.scores);
  if (c.env){
    s += (c.env.outdoors||0) * clamp(state.scores.outdoors,-8,8) * 0.28;
    s += (c.env.desk||0)     * clamp(state.scores.focusDesk,-8,8) * 0.24;
    s += (c.env.travel||0)   * clamp(state.scores.travel,-8,8) * 0.20;
  }
  if (c.education){
    const tol = state.scores.eduTolerance;
    const debt = state.scores.debtAversion;
    const lvl = c.education.level || 0;
    s += tol * lvl * 0.14;
    s -= debt * lvl * 0.14;
  }
  return s;
}

function topSignals(n=6){
  const pairs = Object.entries(state.scores)
    .map(([k,v])=>({k,v}))
    .sort((a,b)=>Math.abs(b.v)-Math.abs(a.v))
    .slice(0,n);
  return pairs;
}
function signalLabel(k){
  const map = {
    outdoors:"outdoor time", focusDesk:"desk/computer focus", handsOn:"hands-on work",
    people:"people interaction", service:"helping/service", creative:"creative work",
    systems:"problem solving & systems", structure:"structure/routine", autonomy:"freedom/independence",
    travel:"variety/travel", detail:"detail/accuracy", leadership:"leading/owning outcomes",
    persuasion:"persuasion/sales", stressTol:"high-pressure tolerance",
    eduTolerance:"school/training tolerance", debtAversion:"debt caution",
    R:"realistic (practical)", I:"investigative (curious)", A:"artistic (creative)", S:"social (helping)", E:"enterprising (leading)", C:"conventional (organized)"
  };
  return map[k] || k;
}
function whyFitText(c){
  const tops = topSignals(8).filter(x => Math.abs(x.v) >= 1.4).slice(0,5);
  const used = [];
  const profKeys = new Set(Object.keys(c.profile||{}));

  for (const t of tops){
    if (profKeys.has(t.k)) used.push(t);
  }
  const picks = used.slice(0,3);
  if (!picks.length){
    return "This matches your overall pattern across interests, work style, and environment.";
  }
  const phrases = picks.map(p=>{
    const dir = p.v >= 0 ? "strong" : "lower";
    return `${dir} in ${signalLabel(p.k)}`;
  });
  return "Because you show " + phrases.join(", ") + ".";
}


function baseTitle(title){
  const prefixes = ["Junior", "Senior", "Field", "Community", "Clinical", "Remote", "Mobile", "Industrial", "Commercial", "Residential", "Outdoor", "Digital", "Applied", "Technical"];
  for (const p of prefixes){
    if (title.startsWith(p + " ")) return title.slice((p + " ").length);
  }
  return title;
}

function sectorList(family){
  const map = {
    "Tech & Engineering":["Private","Government","Education/Research"],
    "Health & People Care":["Private","Hospital/Clinic","Government/Nonprofit"],
    "Skilled Trades":["Private","Union/Contracting","Government/Municipal"],
    "Business & Entrepreneurship":["Private","Nonprofit","Startups"],
    "Education & Helping":["Public schools","Private schools","Nonprofit/Government"],
    "Design & Creative":["Private","Agency/Studio","Freelance"],
    "Public Safety":["Government","Nonprofit","Private (security)"],
    "Science & Environment":["Government","Private","Education/Research"]
  };
  return map[family] || ["Private","Government","Nonprofit"];
}

function payEstimate(eduLevel, family){
  // Simple, clearly-labeled estimate bands (USD). Real numbers vary by region and specialization.
  let lo=40000, hi=65000;
  if (eduLevel<=1){ lo=38000; hi=70000; }
  if (eduLevel==2){ lo=42000; hi=78000; }
  if (eduLevel==3){ lo=52000; hi=95000; }
  if (eduLevel>=4){ lo=65000; hi=120000; }

  // family adjustments
  if (family==="Tech & Engineering"){ lo+=8000; hi+=20000; }
  if (family==="Health & People Care"){ lo+=6000; hi+=18000; }
  if (family==="Public Safety"){ lo+=2000; hi+=8000; }
  if (family==="Design & Creative"){ lo-=2000; hi-=8000; }
  if (family==="Education & Helping"){ lo-=2000; hi-=6000; }

  lo = Math.max(28000, lo); hi = Math.max(lo+12000, hi);
  return {lo,hi};
}

function shortDescription(title, family){
  const base = baseTitle(title);
  const templates = {
    "Tech & Engineering": `Builds and improves software/systems—solving problems with technology.`,
    "Health & People Care": `Helps people improve health, function, safety, and quality of life.`,
    "Skilled Trades": `Builds, installs, repairs, or maintains physical systems using tools and hands-on skill.`,
    "Business & Entrepreneurship": `Grows results through leadership, strategy, sales, operations, and customer value.`,
    "Education & Helping": `Supports learning, growth, and development through teaching, coaching, or guidance.`,
    "Design & Creative": `Creates visuals, experiences, or products that communicate and delight.`,
    "Public Safety": `Protects people and communities through prevention, response, and safety systems.`,
    "Science & Environment": `Studies the natural world and applies science to solve real-world problems.`
  };
  const t = templates[family] || `Works in ${family} to solve practical problems.`;
  return `${base}: ${t}`;
}

function renderResults(){
  state.finished = true;
  setBar();
  setStatus("Results ready.");

  
  const scored = CAREERS.map(c => ({...c, score: careerFit(c), base: baseTitle(c.title)}))
                       .sort((a,b)=>b.score-a.score);

  // Variety rules:
  // - Max 1 result per base role (so you don't get 5 versions of Data Analyst)
  // - Soft cap per family to keep range (default 6)
  const picked = [];
  const seenBase = new Set();
  const famCount = {};
  const FAM_CAP = 6;

  for (const c of scored){
    if (picked.length >= SHOW_TOP) break;
    if (seenBase.has(c.base)) continue;

    const fc = famCount[c.family] || 0;
    if (fc >= FAM_CAP) continue;

    seenBase.add(c.base);
    famCount[c.family] = fc + 1;
    picked.push(c);
  }

  // If caps were too strict, fill remaining with best unused bases.
  if (picked.length < SHOW_TOP){
    for (const c of scored){
      if (picked.length >= SHOW_TOP) break;
      if (seenBase.has(c.base)) continue;
      seenBase.add(c.base);
      picked.push(c);
    }
  }

  const top = picked;

  // Compute overall + per-section match % (normalized within the shown list)
  const sections = ["Work Environment & Energy","Interests & Curiosity","Temperament & Work Style","Values, Purpose & Constraints"];

  const overallRaw = top.map(c=>c.score);
  let oMin = Math.min(...overallRaw), oMax = Math.max(...overallRaw);

  const secRaw = {};
  for (const s of sections){
    secRaw[s] = top.map(c=>sectionFit(c,s));
  }

  for (let k=0;k<top.length;k++){
    const c = top[k];
    c.matchOverall = normalizePct(c.score, oMin, oMax);
    c.matchSections = {};
    c.whySections = {};
    for (const s of sections){
      const arr = secRaw[s];
      const mn = Math.min(...arr), mx = Math.max(...arr);
      c.matchSections[s] = normalizePct(arr[k], mn, mx);
      c.whySections[s] = whyBySection(c, s);
    }
  }



  const strengths = topSignals(8);

  elApp.innerHTML = `
    <div style="font-weight:950;font-size:18px;margin-bottom:6px">Top career matches</div>
    <div class="muted">Use this as a starting point. Pay ranges shown are **estimates** (they vary by location and specialization). Use the O*NET link for detailed, reliable info.</div>

    <div style="height:1px;background:rgba(255,255,255,.12);margin:14px 0"></div>

    <div class="grid">
      <div class="card col6">
        <div style="font-weight:900">Your strongest signals</div>
        <div class="muted" style="margin-top:8px">
          ${strengths.map(s=>`<span class="pill"><b>${escapeHtml(signalLabel(s.k))}</b> ${s.v.toFixed(1)}</span>`).join(" ")}
        </div>
      </div>
      <div class="card col6">
        <div style="font-weight:900">Filter</div>
        <div class="row" style="margin-top:10px">
          <div style="flex:1 1 320px"><input id="search" placeholder="Search (e.g., nurse, engineer, business)"/></div>
          <div style="flex:1 1 220px">
            <select id="fam">
              <option value="">All families</option>
              ${[...new Set(CAREERS.map(x=>x.family))].sort().map(f=>`<option value="${escapeHtml(f)}">${escapeHtml(f)}</option>`).join("")}
            </select>
          </div>
        </div>
        <div class="muted" style="margin-top:10px">Tip: pick 3 careers and research them together.</div>
      </div>

      <div class="col12" id="list"></div>
    </div>
  `;

  const elList = document.getElementById("list");
  const elSearch = document.getElementById("search");
  const elFam = document.getElementById("fam");

  function draw(){
    const q = (elSearch.value||"").toLowerCase().trim();
    const fam = elFam.value;

    const shown = top.filter(c=>{
      if (fam && c.family !== fam) return false;
      if (!q) return true;
      const hay = (c.title + " " + c.family + " " + (c.tags||[]).join(" ")).toLowerCase();
      return hay.includes(q);
    });

    elList.innerHTML = shown.map(c=>{
      const link = (c.source && c.source.search_url) ? c.source.search_url : `https://www.mynextmove.org/find/search?s=${encodeURIComponent(c.title)}`;
      const why = whyFitText(c);
      const desc = shortDescription(c.title, c.family);
      const overallPct = c.matchOverall;
      const secPcts = c.matchSections;
      const whyEnv = c.whySections["Work Environment & Energy"] || "—";
      const whyInt = c.whySections["Interests & Curiosity"] || "—";
      const whyTemp = c.whySections["Temperament & Work Style"] || "—";
      const whyVal = c.whySections["Values, Purpose & Constraints"] || "—";
      return `
        <div class="card" style="padding:14px">
          <div class="row" style="justify-content:space-between;align-items:flex-start">
            <div style="max-width:740px">
              <div style="font-weight:950">${escapeHtml(c.title)}</div>
              <div class="muted">${escapeHtml(c.family)} • ${escapeHtml(c.education?.label || "Varies")}</div>
              <div class="muted" style="margin-top:6px">${escapeHtml((c.tags||[]).slice(0,8).join(" • "))}</div>
              <div class="muted" style="margin-top:8px">${escapeHtml(desc)}</div>
              <div class="muted" style="margin-top:8px"><b>Match:</b> ${overallPct}% overall</div>
              <div class="muted" style="margin-top:8px"><b>Work Environment:</b> ${secPcts["Work Environment & Energy"]}% — ${escapeHtml(whyEnv)}</div>
              <div class="muted" style="margin-top:6px"><b>Interests:</b> ${secPcts["Interests & Curiosity"]}% — ${escapeHtml(whyInt)}</div>
              <div class="muted" style="margin-top:6px"><b>Work Style:</b> ${secPcts["Temperament & Work Style"]}% — ${escapeHtml(whyTemp)}</div>
              <div class="muted" style="margin-top:6px"><b>Values:</b> ${secPcts["Values, Purpose & Constraints"]}% — ${escapeHtml(whyVal)}</div>
              <div class="muted" style="margin-top:10px"><b>Career info:</b> Open the My Next Move link for official summary + pay info.</div>
              <div class="row" style="margin-top:10px">
                <a class="btn" href="${link}" target="_blank" rel="noopener">Learn more (My Next Move)</a>
              </div>
            </div>
            <div class="pill"><b>${overallPct}%</b> match</div>
          </div>
        </div>
      `;
    }).join("") || `<div class="muted">No matches. Try another search.</div>`;
  }

  elSearch.addEventListener("input", draw);
  elFam.addEventListener("change", draw);
  draw();
}

function render(){
  if (state.finished) return renderResults();
  renderQuestion();
}

function resetAll(){
  state = { answered:0, askedIds:[], scores:{}, finished:false, seed: Math.floor(Math.random()*1e9) };
  initScores();

let sectionScores = {};
function initSectionScores(){ sectionScores = {}; }
initSectionScores();

  setStatus(`Loaded ${QUESTIONS?.length||0} questions and ${CAREERS?.length||0} careers.`);
  renderQuestion();
}

loadData();
</script>
</body>
</html>
