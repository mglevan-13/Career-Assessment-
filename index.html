<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Career Fit Assessment — Teen + O*NET-ready</title>
  <meta name="description" content="Adaptive teen career assessment with work-environment fit and O*NET-ready career database."/>
  <style>
    :root{
      --bg0:#070b14; --bg1:#0b1220; --card:rgba(255,255,255,.05);
      --line:rgba(255,255,255,.12); --text:#e9efff; --muted:rgba(233,239,255,.72);
      --brand:#2f6bff; --brand2:#7fb1ff; --max:1060px; --r:16px;
      --shadow:0 14px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
      background:
        radial-gradient(900px 500px at 15% -10%, rgba(47,107,255,.25), transparent 60%),
        radial-gradient(900px 500px at 85% -5%, rgba(127,177,255,.18), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 55%);
      min-height:100vh;
    }
    header{
      padding:20px 16px 14px; border-bottom:1px solid var(--line);
      background:linear-gradient(135deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      position:sticky; top:0; backdrop-filter: blur(10px); z-index:10;
    }
    .wrap{max-width:var(--max); margin:0 auto}
    h1{margin:0 0 6px; font-size:20px}
    .scripture{margin:0 0 10px; font-size:13px; color:var(--muted); line-height:1.35}
    .topRow{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between}
    .status{font-size:13px; color:var(--muted)}
    .barWrap{height:10px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; border:1px solid rgba(255,255,255,.07)}
    .bar{height:100%; width:0%; background:linear-gradient(90deg,var(--brand),var(--brand2)); transition:width .2s ease}

    main{padding:18px 16px 44px}
    .grid{display:grid; gap:12px; grid-template-columns: 1fr}
    @media (min-width: 920px){ .grid{grid-template-columns:1.35fr .85fr} }
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--r); box-shadow:var(--shadow); padding:16px}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .hr{height:1px; background:var(--line); margin:14px 0}
    .muted{color:var(--muted); font-size:13px; line-height:1.45}
    .muted2{color:rgba(233,239,255,.62); font-size:13px; line-height:1.45}
    .btn{
      cursor:pointer; padding:12px 14px; border-radius:14px; border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06); color:var(--text); font-weight:800; letter-spacing:.2px;
      transition:transform .06s ease, background .15s ease, border-color .15s ease;
    }
    .btn:hover{background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.18)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(135deg,var(--brand),#1f4ed0); border-color:rgba(47,107,255,.85)}
    .btn.ghost{background:transparent}
    .btn.small{padding:9px 10px; border-radius:12px; font-weight:750}
    .btn:disabled{opacity:.45; cursor:not-allowed}
    .opt{width:100%; text-align:left}

    .kpi{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .kpi .box{flex:1 1 160px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04); padding:12px}
    .kpi .label{font-size:12px; color:rgba(233,239,255,.62)}
    .kpi .val{font-size:16px; font-weight:950; margin-top:4px}

    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:7px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06);
      font-size:12.5px; color:rgba(233,239,255,.72); margin:6px 6px 0 0;
    }
    .pill b{color:var(--text)}
    .chip{
      display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05); font-size:12px; color:rgba(233,239,255,.62); margin:6px 6px 0 0;
    }
    input[type="search"], select{
      width:100%; padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18); color:var(--text); outline:none;
    }
    textarea{
      width:100%; min-height:110px; border-radius:14px; border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.15); color:var(--text); padding:12px; resize:vertical; outline:none;
    }

    @media print{
      header{position:static}
      .noPrint{display:none !important}
      body{background:white; color:#111}
      .card{box-shadow:none; background:white; border:1px solid #ddd}
      .muted,.muted2,.pill,.chip{color:#333; border-color:#ddd; background:#f6f6f6}
      input,select,textarea{border-color:#ddd; background:#fff; color:#111}
      .btn{display:none !important}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="topRow">
      <div>
        <h1>Career Fit Assessment — High School Edition (O*NET-ready)</h1>
        <p class="scripture"><b>“Come, follow me,” Jesus said.</b> — Matthew 4:19 (NIV)</p>
        <div class="status" id="statusLine">Loading questions and careers…</div>
      </div>
      <div class="row noPrint">
        <button class="btn small ghost" id="btnReset">Reset</button>
        <button class="btn small" id="btnSave">Save</button>
        <button class="btn small" id="btnLoad">Load</button>
        <button class="btn small" id="btnPrint">Print</button>
      </div>
    </div>
    <div class="barWrap"><div class="bar" id="bar"></div></div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="grid">
      <div class="card" id="app"></div>
      <div class="card" id="side">
        <h2 style="margin:0 0 6px; font-size:16px;">How this works (Dad-friendly)</h2>
        <p class="muted">
          This tool is built like a “smart conversation,” not a 200-question exam.
          It has <b>a big bank</b> of questions, but each teen answers a smaller set (adaptive),
          then gets <b>ranked career families</b> and <b>specific career ideas</b>.
        </p>
        <div class="hr"></div>
        <div class="muted2">
          <b>Important:</b> “Thousands of careers” comes from the full O*NET dataset. This starter includes a strong
          base and the exact data format to expand.
        </div>
        <div class="hr"></div>
        <div class="muted2" id="datasetInfo"></div>
      </div>
    </div>
  </div>
</main>

<script>
/* ---------------------------
   CONFIG (you can tune this)
----------------------------*/
const STORAGE_KEY = "career_fit_onet_ready_v1";
const MAX_QUESTIONS = 36;             // robust but not exhausting
const CAREER_RESULTS = 60;            // show top N careers
const FAMILY_RESULTS = 10;            // show top families
const LIKERT = [1,2,3,4,5];           // strongly dislike -> strongly like

// Dimensions we score (traits)
const DIMS = [
  "R","I","A","S","E","C",            // RIASEC interests
  "people","systems","creative","handsOn",
  "structure","autonomy",
  "outdoors","travel","focusDesk",
  "stressTol","service","persuasion","detail","leadership",
  "eduTolerance","debtAversion"
];

// Track definitions
const TRACKS = [
  { id:"daughter_college", name:"Daughter (Senior — College-deciding)", blurb:"Majors + school environment fit + next steps." },
  { id:"son_entrepreneur", name:"Son (Sophomore — Entrepreneur-minded)", blurb:"Skill-stack + whether college is a wise investment." },
  { id:"general_teen", name:"General Teen", blurb:"Balanced assessment for any high schooler." }
];

let QUESTIONS = null;
let CAREERS = null;

// State
let state = {
  trackId: null,
  answered: 0,
  askedIds: [],
  answers: [],         // {id, text, value(1-5)}
  scores: {},
  finished: false
};

const elApp = document.getElementById("app");
const elBar = document.getElementById("bar");
const elStatus = document.getElementById("statusLine");
const elInfo = document.getElementById("datasetInfo");

// Buttons
document.getElementById("btnReset").onclick = resetAll;
document.getElementById("btnSave").onclick = saveLocal;
document.getElementById("btnLoad").onclick = loadLocal;
document.getElementById("btnPrint").onclick = () => window.print();

function initScores(){
  state.scores = {};
  for (const d of DIMS) state.scores[d] = 0;
}

function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

/* ---------------------------
   LOAD DATA
----------------------------*/
async function loadData(){
  try{
    const [q, c] = await Promise.all([
      fetch("./questions.json").then(r=>r.json()),
      fetch("./careers.json").then(r=>r.json())
    ]);
    QUESTIONS = q;
    CAREERS = c;

    elInfo.innerHTML = `
      <div class="pill"><b>${QUESTIONS.questions.length}</b> questions loaded</div>
      <div class="pill"><b>${CAREERS.careers.length}</b> careers loaded</div>
      <div class="pill"><b>${new Set(CAREERS.careers.map(x=>x.family)).size}</b> families</div>
      <div class="muted2" style="margin-top:8px;">
        To scale up to “thousands of careers,” you’ll later replace <code>careers.json</code> with an O*NET-derived file in the same format.
      </div>
    `;
    renderTrackPicker();
  }catch(e){
    elStatus.textContent = "Could not load questions.json or careers.json. Make sure both files are in the repo root.";
    elApp.innerHTML = `
      <h2 style="margin:0 0 6px;">Setup error</h2>
      <p class="muted">Your site can’t find <b>questions.json</b> and/or <b>careers.json</b> in the same folder as index.html.</p>
      <div class="hr"></div>
      <p class="muted2">Fix: create those two files in the repo root, commit, then refresh.</p>
    `;
  }
}

/* ---------------------------
   QUESTION SELECTION (adaptive)
   - Large bank available
   - We pick next question by:
     1) category balance
     2) highest uncertainty dims
     3) avoid repeats
----------------------------*/
function dimUncertainty(){
  // We want more info on dims near 0 (not yet measured)
  // Score uncertainty as inverse of absolute value (smaller abs => higher uncertainty)
  const u = {};
  for (const d of DIMS) u[d] = 1 / (1 + Math.abs(state.scores[d]));
  return u;
}

function pickNextQuestion(){
  const asked = new Set(state.askedIds);
  const pool = QUESTIONS.questions.filter(q => !asked.has(q.id) && (q.tracks?.includes(state.trackId) || q.tracks?.includes("all")));
  if (!pool.length) return null;

  const u = dimUncertainty();

  // Score each question by how much it touches uncertain dims + track priority + category diversity
  const catCounts = {};
  for (const id of state.askedIds){
    const q = QUESTIONS.questions.find(x=>x.id===id);
    if (q) catCounts[q.category] = (catCounts[q.category]||0)+1;
  }

  let best = null;
  let bestScore = -Infinity;

  for (const q of pool){
    let s = 0;

    // dims impact
    for (const [dim, w] of Object.entries(q.weights)){
      s += (u[dim] || 0.1) * Math.abs(w);
    }

    // prefer underrepresented categories a bit
    const count = catCounts[q.category] || 0;
    s += 1 / (1 + count);

    // strong bonus for environment questions early
    if (state.answered < 10 && q.category === "Environment") s += 1.8;

    // track hints
    if (state.trackId === "daughter_college" && q.category === "Education") s += 0.8;
    if (state.trackId === "son_entrepreneur" && q.category === "Entrepreneurship") s += 0.8;

    // slight randomness so it doesn't feel robotic
    s += Math.random() * 0.05;

    if (s > bestScore){ bestScore = s; best = q; }
  }

  return best;
}

/* ---------------------------
   SCORING
   Likert 1-5 centered around 3
----------------------------*/
function applyAnswer(q, value){
  // value: 1..5
  // centered: -2..+2
  const centered = value - 3;

  for (const [dim, w] of Object.entries(q.weights)){
    state.scores[dim] = (state.scores[dim] || 0) + centered * w;
  }

  state.answers.push({ id:q.id, text:q.text, value });
  state.askedIds.push(q.id);
  state.answered++;
}

function progress(){
  if (!state.trackId) return 0;
  return Math.round((state.answered / MAX_QUESTIONS) * 100);
}

function setHeader(){
  if (!state.trackId){
    elStatus.textContent = "Choose a track to begin.";
    elBar.style.width = "0%";
    return;
  }
  if (state.finished){
    elStatus.textContent = "Results ready.";
    elBar.style.width = "100%";
    return;
  }
  elStatus.textContent = `Question ${state.answered + 1} of ${MAX_QUESTIONS}`;
  elBar.style.width = progress() + "%";
}

/* ---------------------------
   CAREER MATCHING
----------------------------*/
function dot(a, b){
  let s = 0;
  for (const [k,v] of Object.entries(a)){
    s += (b[k] || 0) * v;
  }
  return s;
}

function normalizeScore(n){ return n; } // placeholder if you want scaling later

function careerFit(career){
  // Build user profile (use only dims careers know about)
  const user = state.scores;

  // Base interest/trait match
  let s = dot(career.profile, user);

  // Environment and education filters (soft preferences)
  // career.env values 0..5, user dims are centered-ish. We'll translate:
  const wantOutdoors = state.scores.outdoors;
  const wantDesk = state.scores.focusDesk;
  const wantTravel = state.scores.travel;

  if (career.env){
    s += (career.env.outdoors || 0) * clamp(wantOutdoors, -6, 6) * 0.35;
    s += (career.env.desk || 0)     * clamp(wantDesk, -6, 6)     * 0.30;
    s += (career.env.travel || 0)   * clamp(wantTravel, -6, 6)   * 0.25;
  }

  // Education tolerance vs required training (soft)
  if (career.education){
    const tol = state.scores.eduTolerance;      // higher = ok with more school
    const debt = state.scores.debtAversion;     // higher = avoid debt/long school
    s += (tol * (career.education.level || 0)) * 0.20;
    s -= (debt * (career.education.level || 0)) * 0.20;
  }

  return normalizeScore(s);
}

function rankCareers(){
  const scored = CAREERS.careers.map(c => ({...c, score: careerFit(c)}));
  scored.sort((a,b)=>b.score - a.score);
  return scored;
}

function rankFamilies(scoredCareers){
  const byFam = {};
  for (const c of scoredCareers){
    byFam[c.family] = byFam[c.family] || { family:c.family, score:0, count:0 };
    byFam[c.family].score += c.score;
    byFam[c.family].count += 1;
  }
  const arr = Object.values(byFam).map(x=>({...x, avg: x.score / x.count}));
  arr.sort((a,b)=>b.avg - a.avg);
  return arr;
}

/* ---------------------------
   RENDERING
----------------------------*/
function renderTrackPicker(){
  initScores();
  state.trackId = null;
  state.answered = 0;
  state.askedIds = [];
  state.answers = [];
  state.finished = false;
  setHeader();

  elApp.innerHTML = `
    <h2 style="margin:0 0 6px;">Pick your track</h2>
    <p class="muted">Answer fast and honest. This is about clarity, not “perfect answers.”</p>
    <div class="hr"></div>
    <div class="row">
      ${TRACKS.map(t => `
        <div class="card" style="padding:14px; width:100%;">
          <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start;">
            <div>
              <div style="font-weight:950;">${t.name}</div>
              <div class="muted">${t.blurb}</div>
            </div>
            <button class="btn primary" onclick="startTrack('${t.id}')">Start</button>
          </div>
        </div>
      `).join("")}
    </div>
    <div class="hr"></div>
    <div class="muted2">Dad tip: don’t “coach” answers. Let them be real, then discuss the results together.</div>
  `;
}

window.startTrack = function(trackId){
  initScores();
  state.trackId = trackId;
  state.answered = 0;
  state.askedIds = [];
  state.answers = [];
  state.finished = false;
  renderQuestion();
};

function renderQuestion(){
  setHeader();
  const q = pickNextQuestion();
  if (!q || state.answered >= MAX_QUESTIONS){
    return renderResults();
  }

  elApp.innerHTML = `
    <h2 style="margin:0 0 6px;">${escapeHtml(q.text)}</h2>
    <p class="muted">${escapeHtml(q.hint || "Rate how true this is for you.")}</p>
    <div class="hr"></div>

    <div class="row">
      ${LIKERT.map(v => `
        <button class="btn opt" onclick="answerLikert('${q.id}', ${v})">
          ${likertLabel(v)}
        </button>
      `).join("")}
    </div>

    <div class="hr"></div>

    <div class="row noPrint" style="justify-content:space-between;">
      <div class="row">
        <button class="btn" onclick="backOne()" ${state.answers.length ? "" : "disabled"}>Back</button>
        <button class="btn ghost" onclick="renderResults()">Finish now</button>
      </div>
      <div class="row">
        <button class="btn small" onclick="saveLocal()">Save</button>
      </div>
    </div>
  `;

  // stash current question id in DOM for answer function
  elApp.dataset.currentQ = q.id;
}

window.answerLikert = function(qid, value){
  const q = QUESTIONS.questions.find(x=>x.id===qid);
  if (!q) return;
  applyAnswer(q, value);
  renderQuestion();
};

window.backOne = function(){
  if (!state.answers.length) return;

  // Remove last answer and recompute scores from scratch
  state.answers.pop();
  state.askedIds.pop();
  state.answered = state.answers.length;
  initScores();
  for (const a of state.answers){
    const q = QUESTIONS.questions.find(x=>x.id===a.id);
    applyAnswerReplay(q, a.value);
  }
  renderQuestion();
};

function applyAnswerReplay(q, value){
  const centered = value - 3;
  for (const [dim, w] of Object.entries(q.weights)){
    state.scores[dim] = (state.scores[dim] || 0) + centered * w;
  }
}

function renderResults(){
  state.finished = true;
  setHeader();

  const scored = rankCareers();
  const fams = rankFamilies(scored);

  const topCareers = scored.slice(0, CAREER_RESULTS);
  const topFamilies = fams.slice(0, FAMILY_RESULTS);

  const envSummary = summarizeEnvironment();
  const trackNotes = trackAddOn();

  elApp.innerHTML = `
    <div class="row" style="justify-content:space-between; align-items:flex-start;">
      <div>
        <h2 style="margin:0 0 6px;">Results</h2>
        <p class="muted">This is a ranked starting point. The goal is a wise next step, not a life sentence.</p>
      </div>
      <div class="row noPrint">
        <button class="btn primary" onclick="window.print()">Print / Save PDF</button>
        <button class="btn" onclick="startTrack(state.trackId)">Retake</button>
      </div>
    </div>

    <div class="kpi">
      <div class="box"><div class="label">Track</div><div class="val">${escapeHtml(TRACKS.find(t=>t.id===state.trackId)?.name || "")}</div></div>
      <div class="box"><div class="label">Questions answered</div><div class="val">${state.answered}</div></div>
      <div class="box"><div class="label">Top family</div><div class="val">${escapeHtml(topFamilies[0]?.family || "—")}</div></div>
    </div>

    <div class="hr"></div>

    <h3 style="margin:0 0 6px; font-size:16px;">Work environment fit</h3>
    <ul class="muted">
      ${envSummary.map(x=>`<li>${x}</li>`).join("")}
    </ul>

    <div class="hr"></div>

    <h3 style="margin:0 0 6px; font-size:16px;">Top career families</h3>
    <div>
      ${topFamilies.map(f=>`
        <span class="pill"><b>${escapeHtml(f.family)}</b> — ${f.avg.toFixed(1)} avg</span>
      `).join("")}
    </div>

    <div class="hr"></div>

    <h3 style="margin:0 0 6px; font-size:16px;">Career matches (search + filter)</h3>
    <div class="row">
      <div style="flex:1 1 320px;">
        <input id="careerSearch" type="search" placeholder="Search careers (e.g., nurse, engineer, marketing)"/>
      </div>
      <div style="flex:1 1 220px;">
        <select id="familyFilter">
          <option value="">All families</option>
          ${[...new Set(CAREERS.careers.map(c=>c.family))].sort().map(f=>`<option value="${escapeHtml(f)}">${escapeHtml(f)}</option>`).join("")}
        </select>
      </div>
    </div>

    <div id="careerList" style="margin-top:12px;"></div>

    ${trackNotes ? `
      <div class="hr"></div>
      <h3 style="margin:0 0 6px; font-size:16px;">${escapeHtml(trackNotes.title)}</h3>
      <ul class="muted">${trackNotes.bullets.map(b=>`<li>${b}</li>`).join("")}</ul>
    ` : ""}

    <div class="hr"></div>

    <h3 style="margin:0 0 6px; font-size:16px;">Notes</h3>
    <textarea placeholder="What felt true…&#10;What felt wrong…&#10;Next step I’m willing to take…"></textarea>

    <div class="hr"></div>
    <div class="row noPrint">
      <button class="btn" onclick="toggleAnswers()">Show my answers</button>
      <button class="btn ghost" onclick="saveLocal()">Save</button>
    </div>
    <div id="answersBox" style="display:none; margin-top:12px;" class="card"></div>
  `;

  // render careers list
  const list = document.getElementById("careerList");
  const search = document.getElementById("careerSearch");
  const filter = document.getElementById("familyFilter");

  function draw(){
    const q = (search.value || "").trim().toLowerCase();
    const fam = filter.value;

    const shown = topCareers.filter(c=>{
      if (fam && c.family !== fam) return false;
      if (!q) return true;
      return (c.title.toLowerCase().includes(q) || (c.tags||[]).join(" ").toLowerCase().includes(q));
    }).slice(0, 50);

    list.innerHTML = shown.map(c=>careerCard(c)).join("") || `<div class="muted2">No matches. Try a different search.</div>`;
  }

  search.addEventListener("input", draw);
  filter.addEventListener("change", draw);
  draw();
}

function careerCard(c){
  const edu = c.education?.label || "Varies";
  const env = c.env ? [
    c.env.outdoors ? `Outdoors ${c.env.outdoors}/5` : null,
    c.env.desk ? `Desk ${c.env.desk}/5` : null,
    c.env.travel ? `Travel ${c.env.travel}/5` : null
  ].filter(Boolean).join(" • ") : "—";

  return `
    <div class="card" style="padding:14px; margin:10px 0;">
      <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start;">
        <div>
          <div style="font-weight:950;">${escapeHtml(c.title)}</div>
          <div class="muted2">${escapeHtml(c.family)} • ${escapeHtml(edu)}</div>
          <div class="muted2" style="margin-top:6px;">${escapeHtml(env)}</div>
          <div style="margin-top:8px;">
            ${(c.tags||[]).slice(0,6).map(t=>`<span class="chip">${escapeHtml(t)}</span>`).join("")}
          </div>
        </div>
        <div class="pill"><b>${c.score.toFixed(1)}</b> fit</div>
      </div>
    </div>
  `;
}

/* ---------------------------
   Environment summary
----------------------------*/
function summarizeEnvironment(){
  const s = state.scores;
  const out = [];
  if (s.outdoors >= 5) out.push("You’ll likely thrive with **regular outdoor/field time** most weeks.");
  if (s.outdoors <= -4) out.push("You’ll likely prefer **mostly indoor** environments.");
  if (s.focusDesk >= 5) out.push("You can handle **focused computer/desk work** without burning out.");
  if (s.focusDesk <= -4) out.push("Too much desk time may drain you—look for roles with **movement**.");
  if (s.travel >= 4) out.push("You may enjoy **variety/changing locations** (some travel is a plus).");
  if (s.handsOn >= 5) out.push("You’ll want **hands-on work** built into your week.");
  if (s.people >= 5) out.push("You’ll be happier with **regular people interaction**.");
  if (!out.length) out.push("You seem flexible — a **mixed environment** can fit you well.");
  return out.map(x=>x.replace(/\*\*(.*?)\*\*/g, "<b>$1</b>"));
}

/* ---------------------------
   Track add-ons
----------------------------*/
function trackAddOn(){
  const s = state.scores;
  if (state.trackId === "daughter_college"){
    const bullets = [];
    if (s.people >= 5) bullets.push("Consider **small/medium campuses** with strong community and mentoring.");
    if (s.handsOn >= 4) bullets.push("Look for majors with **labs, clinicals, studios, co-ops, internships** built in.");
    if (s.I >= 4 && s.focusDesk >= 4) bullets.push("You may thrive in **rigorous problem-solving majors** (engineering, CS, data, sciences).");
    if (s.A >= 4) bullets.push("You may thrive in **portfolio/studio majors** (design, architecture, UX).");
    if (s.debtAversion >= 4) bullets.push("Be strategic on cost: start with **in-state**, scholarships, and programs with strong placement.");
    return { title:"College fit notes", bullets: bullets.length ? bullets : ["Visit 2 campus types and notice where you feel calm, confident, and energized."] };
  }
  if (state.trackId === "son_entrepreneur"){
    const bullets = [];
    bullets.push("Skill stack (the money combo): **sales + a real skill + systems**.");
    if (s.persuasion >= 4 || s.E >= 4) bullets.push("Lean into **sales/marketing** early — it multiplies every business.");
    if (s.handsOn >= 4 && s.R >= 4) bullets.push("A hands-on lane can become a business: **service → repeat customers → team**.");
    if (s.systems >= 4 || s.I >= 4) bullets.push("Build leverage with **tech/automation/data** even at a basic level.");
    if (s.debtAversion >= 4) bullets.push("Keep options: consider **community college + transfer** or **apprentice + business**.");
    return { title:"Entrepreneur notes", bullets };
  }
  return null;
}

/* ---------------------------
   Likert labels
----------------------------*/
function likertLabel(v){
  if (v===1) return "Strongly dislike / Not me";
  if (v===2) return "Somewhat dislike";
  if (v===3) return "Neutral / Depends";
  if (v===4) return "Somewhat like";
  return "Strongly like / Very me";
}

/* ---------------------------
   Answers display
----------------------------*/
window.toggleAnswers = function(){
  const box = document.getElementById("answersBox");
  if (!box) return;
  const showing = box.style.display !== "none";
  box.style.display = showing ? "none" : "block";
  if (!showing){
    box.innerHTML = `
      <h3 style="margin:0 0 6px; font-size:16px;">Answers</h3>
      ${state.answers.map(a=>`
        <div style="margin:10px 0;">
          <div class="muted2">${escapeHtml(a.text)}</div>
          <div style="font-weight:900;">${likertLabel(a.value)}</div>
        </div>
      `).join("")}
    `;
  }
};

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[s]));
}

/* ---------------------------
   Save/Load/Reset
----------------------------*/
function saveLocal(){
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    toast("Saved on this device.");
  }catch(e){ toast("Could not save (storage blocked)."); }
}
function loadLocal(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return toast("No saved run found.");
    const s = JSON.parse(raw);
    if (!s || !s.scores) return toast("Saved data looks incomplete.");
    state = s;
    if (!state.scores) initScores();
    if (!state.trackId) renderTrackPicker();
    else if (state.finished) renderResults();
    else renderQuestion();
    toast("Loaded.");
  }catch(e){ toast("Could not load."); }
}
function resetAll(){
  if (!confirm("Reset this run?")) return;
  state = { trackId:null, answered:0, askedIds:[], answers:[], scores:{}, finished:false };
  renderTrackPicker();
}

function toast(msg){
  const el = document.createElement("div");
  el.textContent = msg;
  el.style.position="fixed"; el.style.bottom="18px"; el.style.left="50%"; el.style.transform="translateX(-50%)";
  el.style.padding="10px 12px"; el.style.borderRadius="999px";
  el.style.background="rgba(0,0,0,.65)"; el.style.border="1px solid rgba(255,255,255,.14)";
  el.style.color="white"; el.style.fontWeight="800"; el.style.zIndex="999";
  document.body.appendChild(el);
  setTimeout(()=>el.remove(), 1400);
}

/* Boot */
loadData();
</script>
</body>
</html>


